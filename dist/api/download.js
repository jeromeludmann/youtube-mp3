'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _promise=require('babel-runtime/core-js/promise');var _promise2=_interopRequireDefault(_promise);exports.downloadFromYoutube=downloadFromYoutube;var _path=require('path');var _path2=_interopRequireDefault(_path);var _child_process=require('child_process');var _url=require('url');var _url2=_interopRequireDefault(_url);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function downloadFromYoutube(_ref,callback){var key=_ref.key,url=_ref.url,target=_ref.target,_ref$verbose=_ref.verbose,verbose=_ref$verbose===undefined?false:_ref$verbose;return new _promise2.default(function(resolve,reject){var extractedFile=null;var youtubeDlArgs=['-f','bestaudio','--add-metadata','--extract-audio','-k',rebuildUrl(url),'-o',target];if(verbose){youtubeDlArgs.push('--verbose')}var youtubedl=(0,_child_process.spawn)(_path2.default.resolve(__dirname,'..','..','bin','youtube-dl'),youtubeDlArgs);var onData=function onData(data){var filter='[ffmpeg] Adding metadata to';var outputLine=data.toString();if(outputLine.indexOf(filter)>-1){extractedFile=outputLine.slice(filter.length+2,outputLine.length-2).trim()}callback(key,outputLine)};var onClose=function onClose(code){if(code!==0){console.error('Error while downloading Youtube video ID: '+key)}resolve(extractedFile)};youtubedl.stdout.on('data',onData);youtubedl.stderr.on('data',onData);youtubedl.on('close',onClose)})}var rebuildUrl=function rebuildUrl(urlString){var _url$parse=_url2.default.parse(urlString,true),protocol=_url$parse.protocol,host=_url$parse.host,pathname=_url$parse.pathname,query=_url$parse.query;return protocol+'//'+host+pathname+'?v='+query.v};